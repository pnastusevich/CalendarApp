# CalendarApp - Календарь тренировок

Приложение-календарь для отображения тренировок с использованием SwiftUI, архитектуры MVVM + Coordinator.

## Технические требования

- **Язык:** Swift
- **UI Framework:** SwiftUI
- **Архитектура:** MVVM + Coordinator
- **Минимальная iOS:** iOS 16.0+
- **Зависимости:** 
  - Combine (встроен в iOS)
  - Swift Charts (iOS 16+)
  - MapKit (встроен в iOS)
  - PhotosUI (встроен в iOS)

## Структура проекта

```
CalendarApp/
├── Models/
│   ├── Workout.swift              # Модель тренировки
│   ├── WorkoutMetadata.swift      # Метаданные тренировки
│   ├── DiagramData.swift          # Данные для графиков
│   └── OnboardingSlide.swift      # Модель слайда онбординга
├── Services/
│   ├── DataService.swift          # Сервис загрузки данных из JSON
│   ├── UserDefaultsService.swift  # Сервис для работы с UserDefaults
│   └── PhotoLibraryService.swift  # Сервис для работы с фото-галереей
├── ViewModels/
│   ├── CalendarViewModel.swift    # ViewModel для календаря
│   ├── WorkoutDetailViewModel.swift # ViewModel для деталей тренировки
│   ├── OnboardingViewModel.swift  # ViewModel для онбординга
│   └── ProfileViewModel.swift     # ViewModel для профиля
├── Coordinators/
│   ├── AppCoordinator.swift       # Координатор навигации
│   └── CalendarAppApp.swift       # Точка входа приложения
├── Views/
│   ├── CalendarView.swift         # Главный экран календаря
│   ├── WorkoutListView.swift      # Список тренировок за день
│   ├── WorkoutDetailView.swift    # Детали тренировки
│   ├── OnboardingView.swift       # Экран онбординга
│   ├── ProfileView.swift          # Экран профиля
│   └── WorkoutDetail/
│       ├── WorkoutHeaderView.swift      # Заголовок тренировки
│       ├── WorkoutStatisticsView.swift  # Статистика тренировки
│       ├── HeartRateChartView.swift     # График пульса
│       ├── SpeedChartView.swift         # График скорости
│       ├── WorkoutMapView.swift         # Карта маршрута
│       └── WorkoutCommentView.swift     # Комментарий к тренировке
├── Helpers/
│   ├── WorkoutTypeHelper.swift    # Хелпер для типов тренировок
│   ├── DateFormatterHelper.swift  # Хелпер для форматирования дат
│   ├── CalendarDayStyleHelper.swift # Хелпер для стилей дней календаря
│   └── MapHelper.swift            # Хелпер для работы с картой
├── Resources/
│   ├── LocalizationHelper.swift    # Хелпер для локализации
│   ├── ru.lproj/
│   │   └── Localizable.strings    # Русская локализация
│   └── en.lproj/
│       └── Localizable.strings    # Английская локализация
└── Data/
    ├── diagram_data.json          # Данные для графиков
    ├── list_workouts.json         # Список тренировок
    └── metadata.json              # Метаданные тренировок
```

## Функциональность

### ✅ Реализовано

#### 1. Экран календаря месяца
- Отображение календаря на текущий месяц
- Навигация между месяцами (вперёд/назад)
- Переход на сегодняшний день
- Визуальное выделение текущего дня
- Индикаторы дней с тренировками (точки под датой)
- Выделение выбранного дня
- Автоматическое переключение месяца при выборе дня из соседнего месяца
- Локализованные названия дней недели и месяцев

#### 2. Список событий выбранного дня
- Отображение списка тренировок при выборе дня
- Для каждой тренировки показаны:
  - Тип тренировки с иконкой
  - Время начала
  - Цветовая индикация типа
- Сообщение при отсутствии тренировок

#### 3. Экран деталей тренировки
- Полная информация о тренировке:
  - Тип и дата/время
  - Дистанция (в км)
  - Длительность (часы и минуты)
  - Температура и влажность
  - Комментарий
- **График пульса** из данных `diagram_data.json`:
  - Линейный график с заливкой
  - Статистика пульса (макс, мин, средний)
- **График скорости** из данных `diagram_data.json`:
  - Линейный график с заливкой
  - Статистика скорости (макс, мин, средняя)
- **Карта маршрута**:
  - Отображение маршрута по GPS координатам
  - Аннотации старта и финиша
  - Автоматический расчёт области видимости

#### 4. Экран онбординга
- Отображение при первом запуске приложения
- Два слайда с описанием возможностей приложения
- Использование иконки приложения из Assets
- Навигация между слайдами (вперёд/назад)
- Кнопка "Начать" на последнем слайде

#### 5. Экран профиля
- **Персональные данные:**
  - Имя
  - Email
  - Номер телефона
  - Дата рождения
- **Фото профиля:**
  - Выбор фото из галереи
  - Запрос разрешения на доступ к фото
  - Сохранение выбранного фото
- **Настройки внешнего вида:**
  - Выбор темы приложения (Системная/Светлая/Тёмная)
  - Применение темы ко всему приложению
- Автоматическое сохранение всех данных

#### 6. Навигация
- TabBar с двумя вкладками:
  - Календарь
  - Профиль
- Навигация через `AppCoordinator` с использованием `NavigationStack`
- Главный экран: `CalendarView`
- Детали тренировки: `WorkoutDetailView` (открывается при нажатии на тренировку)

#### 7. Локализация
- Поддержка двух языков:
  - Русский (по умолчанию)
  - Английский
- Локализованы все строки интерфейса
- Локализованы названия дней недели и месяцев

#### 8. Архитектура
- **MVVM паттерн:**
  - Все бизнес-логика вынесена в ViewModels
  - Views содержат только UI код
- **Coordinator для навигации:**
  - Централизованное управление навигацией
  - Разделение ответственности
- **Разделение на слои:**
  - Models - модели данных
  - Views - UI компоненты
  - ViewModels - бизнес-логика
  - Coordinators - навигация
  - Services - сервисы для работы с данными
  - Helpers - вспомогательные функции
- **Использование Combine:**
  - Реактивное программирование
  - Асинхронная загрузка данных
  - Реактивное обновление UI через `@Published` свойства

#### 9. Сервисы
- **DataService:**
  - Загрузка данных из JSON файлов
  - Использование Combine для асинхронной загрузки
  - Обработка ошибок
- **UserDefaultsService:**
  - Абстракция для работы с UserDefaults
  - Сохранение/загрузка профиля пользователя
  - Сохранение настроек темы
- **PhotoLibraryService:**
  - Абстракция для работы с фото-галереей
  - Запрос разрешений на доступ к фото
  - Проверка статуса разрешений

#### 10. Helpers
- **WorkoutTypeHelper:**
  - Получение иконки по типу тренировки
  - Получение цвета по типу тренировки
- **DateFormatterHelper:**
  - Форматирование дат для отображения
  - Форматирование времени
- **CalendarDayStyleHelper:**
  - Определение цветов для дней календаря
  - Стилизация выбранного дня, сегодняшнего дня, дней с тренировками
- **MapHelper:**
  - Расчёт области видимости карты
  - Создание аннотаций для карты

#### 11. UI/UX
- Адаптация под светлую/тёмную тему
- Современный и опрятный интерфейс
- Корректная работа на разных размерах экранов
- Плавные анимации и переходы
- Использование системных цветов и стилей

## Типы тренировок

- **Walking/Running** (Бег/ходьба) - зелёный цвет, иконка бегуна
- **Cycling** (Велоспорт) - синий цвет, иконка велосипеда
- **Yoga** (Йога) - фиолетовый цвет, иконка йоги
- **Water** (Водные процедуры) - голубой цвет, иконка капли
- **Strength** (Силовые тренировки) - оранжевый цвет, иконка гантели

## Данные

Приложение использует захардкоженные JSON-файлы, которые имитируют данные с сервера:
- `list_workouts.json` - список всех тренировок
- `metadata.json` - метаданные тренировок (дистанция, длительность, комментарии, температура, влажность)
- `diagram_data.json` - данные для графиков (пульс, скорость, GPS координаты, время, шаги, высота, температура)

## Тестирование

### Unit тесты

Проект включает комплексный набор unit тестов:

- **WorkoutTests.swift** - тесты модели тренировки
- **WorkoutMetadataTests.swift** - тесты метаданных тренировки
- **CalendarViewModelTests.swift** - тесты логики календаря
- **WorkoutDetailViewModelTests.swift** - тесты логики деталей тренировки
- **ProfileViewModelTests.swift** - тесты логики профиля
- **UserDefaultsServiceTests.swift** - тесты сервиса UserDefaults
- **ThemeOptionTests.swift** - тесты опций темы

Все тесты находятся в папке `CalendarAppTests/`. Для запуска тестов используйте `Cmd+U` в Xcode.

## Запуск проекта

1. Откройте `CalendarApp.xcodeproj` в Xcode
2. Убедитесь, что JSON-файлы добавлены в бандл проекта (находятся в папке `Data/`)
3. Выберите симулятор или устройство (iOS 16.0+)
4. Запустите проект (⌘R)

## Особенности реализации

### Архитектурные решения

- **Dependency Injection:** Сервисы внедряются через инициализаторы для улучшения тестируемости
- **Protocol-Oriented Programming:** Использование протоколов для абстракции сервисов
- **Separation of Concerns:** Чёткое разделение ответственности между слоями
- **Reactive Programming:** Использование Combine для реактивного обновления UI

### Технические детали

- Использование `Combine` для асинхронной загрузки данных
- Реактивное обновление UI через `@Published` свойства
- Кастомный календарь с поддержкой локализации
- Графики построены с использованием Swift Charts
- Карта маршрута реализована через MapKit и UIViewRepresentable
- Поддержка светлой и тёмной темы через системные цвета
- Запрос разрешений на доступ к фото-галерее
- Сохранение данных пользователя в UserDefaults

### Безопасность и приватность

- Запрос разрешений на доступ к фото-галерее перед открытием
- Обработка всех возможных статусов разрешений
- Направление пользователя в настройки при отказе в доступе

## Структура данных

### Workout
```swift
- workoutKey: String          # Уникальный идентификатор
- workoutActivityType: String # Тип тренировки
- workoutStartDate: String    # Дата и время начала
```

### WorkoutMetadata
```swift
- distanceMeters: Double      # Дистанция в метрах
- durationSeconds: Int        # Длительность в секундах
- avgTemp: Double             # Средняя температура
- avgHumidity: Double         # Средняя влажность
- comment: String             # Комментарий
```

### DiagramDataPoint
```swift
- timeNumeric: Double         # Время в числовом формате
- heartRate: Int              # Пульс
- speedKmh: Double            # Скорость в км/ч
- latitude: Double            # Широта GPS
- longitude: Double           # Долгота GPS
- distanceMeters: Double      # Дистанция
- steps: Int                  # Шаги
- elevation: Double           # Высота
- temperatureCelsius: Double  # Температура
```

## Будущие улучшения

- [ ] Кэширование данных
- [ ] Поддержка офлайн режима
- [ ] Анимации переходов
- [ ] Экспорт данных тренировок
- [ ] Синхронизация с облачными сервисами
- [ ] Статистика за период
- [ ] Напоминания о тренировках
- [ ] Социальные функции (делиться результатами)

## Лицензия

Этот проект создан в образовательных целях.
